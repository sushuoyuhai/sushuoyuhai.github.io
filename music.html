<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网易云音乐解析</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/plyr/3.7.8/plyr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(-45deg, #6B8DD6, #4ECDC4, #45B7AF, #3DBDB4, #6B8DD6);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            color: #ffffff;
            position: relative;
            overflow-x: hidden;
        }
        @keyframes gradient {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 40px;
            border-radius: 30px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        .container.playing {
            transform: translateY(-200px);
        }
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
            gap: 30px;
            position: relative;
            z-index: 1;
        }
        .header::after {
            display: none;
        }
        .share-button {
            width: auto;
            min-width: 100px;
            background: linear-gradient(120deg, #FF6B6B, #FF8E8E);
            border: none;
            border-radius: 12px;
            padding: 8px 16px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            box-shadow: 0 4px 8px rgba(255,107,107,0.2);
        }
        .logo {
            width: 80px;
            height: 80px;
            border-radius: 20px;
        }
        h1 {
            font-size: 40px;
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(120deg, #FF6B6B, #4ECDC4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        .input-group {
            position: relative;
            z-index: 1;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.8);
            padding: 30px;
            border-radius: 24px;
        }
        .input-group.hidden {
            transform: translateY(-100%);
            opacity: 0;
            pointer-events: none;
        }
        input[type="text"], select {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid #e0e0e0;
            border-radius: 18px;
            margin-bottom: 20px;
            font-size: 16px;
            background-color: #ffffff;
        }
        input[type="text"]:focus, select:focus {
            outline: none;
            border-color: #FF6B6B;
        }
        .action-buttons {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: nowrap;
            justify-content: space-between;
        }
        .action-btn {
            padding: 16px 24px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            flex-grow: 1;
        }
        .song-info {
            display: flex;
            margin-bottom: 40px;
            background: rgba(255, 255, 255, 0.8);
            padding: 35px;
            border-radius: 28px;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255,255,255,0.2);
            gap: 35px;
        }
        .song-cover {
            width: 300px;
            height: 300px;
            border-radius: 20px;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }
        .song-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 20px;
        }
        .song-details h2 {
            font-size: 36px;
            margin-bottom: 25px;
            color: #2c3e50;
            font-weight: 800;
            line-height: 1.2;
            position: relative;
            transition: color 0.3s ease;
        }
        .song-details h2::after {
            display: none;
        }
        .song-details p {
            margin: 8px 0;
            color: #34495E;
            font-size: 17px;
            line-height: 1.6;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .download-buttons {
            display: flex;
            flex-direction: row;
            gap: 20px;
            margin-top: 30px;
            justify-content: space-between;
            flex-wrap: nowrap;
        }
        .download-btn {
            padding: 16px 24px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            flex-grow: 1;
        }
        .lyrics {
            background: rgba(255, 255, 255, 0.1);
            padding: 35px;
            border-radius: 28px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 17px;
            color: #333333;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255,255,255,0.2);
            margin-top: 30px;
            backdrop-filter: blur(10px);
            scroll-behavior: smooth;
        }
        /* 自定义滚动条样式 */
        .lyrics::-webkit-scrollbar {
            width: 4px;
            background: transparent;
        }
        .lyrics::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 107, 0.3);
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        .lyrics:hover::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 107, 0.6);
        }
        .lyrics::-webkit-scrollbar-track {
            background: transparent;
        }
        .lyrics p {
            margin: 15px 0;
            padding: 12px 18px;
            border-radius: 14px;
            position: relative;
            cursor: pointer;
            color: #333333;
            transition: all 0.3s ease;
            opacity: 0.6;
            transform: translateY(0);
        }
        .lyrics p.active {
            color: #FF6B6B;
            font-weight: 600;
            background: rgba(255, 107, 107, 0.1);
            opacity: 1;
            transform: translateY(-2px);
        }
        .lyrics .time {
            color: #666666;
            font-size: 16px;
            margin-right: 15px;
            font-family: monospace;
            font-weight: 600;
            user-select: none;
            transition: color 0.3s ease;
        }
        @media screen and (max-width: 768px) {
            body {
                padding: 15px;
            }
            .container {
                padding: 25px;
                border-radius: 24px;
            }
            .header {
                flex-direction: column;
                gap: 20px;
                margin-bottom: 30px;
            }
            .logo {
                width: 70px;
                height: 70px;
            }
            h1 {
                font-size: 32px;
            }
            .input-group {
                padding: 25px;
                border-radius: 20px;
                background-color: #ffffff;
            }
            input[type="text"], select {
                padding: 16px 20px;
                font-size: 16px;
                border-radius: 16px;
                background-color: #ffffff;
            }
            .action-buttons {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: space-around;
                background-color: transparent;
            }
            .action-buttons .random-btn {
                display: flex;
            }
            .action-btn {
                padding: 14px;
                font-size: 15px;
                border-radius: 14px;
            }
            .song-info {
                flex-direction: column;
                padding: 25px;
                border-radius: 24px;
                gap: 25px;
            }
            .song-cover {
                width: 250px;
                height: 250px;
                margin: 0 auto;
            }
            .song-details {
                text-align: center;
            }
            .song-details h2 {
                font-size: 28px;
                margin-bottom: 20px;
            }
            .song-details h2::after {
                left: 50%;
                transform: translateX(-50%);
            }
            .song-details p {
                justify-content: center;
                font-size: 16px;
            }
            .download-buttons {
                flex-direction: row;
                gap: 15px;
                flex-wrap: wrap;
                justify-content: space-around;
            }
            .download-btn {
                padding: 14px;
                font-size: 15px;
                border-radius: 14px;
            }
            .lyrics {
                padding: 25px;
                border-radius: 24px;
                max-height: 400px;
                font-size: 16px;
            }
            .lyrics p {
                margin: 12px 0;
                padding: 10px 15px;
            }
            .lyrics .time {
                font-size: 15px;
            }
            .random-music-group {
                flex-direction: row;
                gap: 10px;
                align-items: center;
                width: auto;
            }
            .player-container {
                padding: 10px;
                border-radius: 12px;
                margin: 20px 0;
            }
            .player-container audio,
            .result > audio {
                width: 100%;
                max-width: 100%;
                margin: 10px 0;
                border-radius: 8px;
            }
            .download-buttons, .lyrics-copy-buttons {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }
            .download-btn {
                width: 100%;
                min-width: unset;
                max-width: 100%;
                font-size: 14px;
                padding: 10px;
            }
            .lyrics {
                padding: 15px;
                border-radius: 14px;
                max-height: 250px;
                font-size: 14px;
            }
        }
        .result {
            margin-top: 40px;
            display: none;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .welcome-text {
            text-align: center;
            color: #000000;
            margin: 40px 0;
            font-size: 18px;
            line-height: 1.6;
            opacity: 0.8;
        }
        .welcome-text p {
            margin: 10px 0;
        }
        .welcome-text .highlight {
            color: #FF6B6B;
            font-weight: 600;
        }
        .search-btn {
            background: linear-gradient(120deg, #FF6B6B, #FF8E8E);
            box-shadow: 0 6px 12px rgba(255,107,107,0.2);
        }
        .search-btn:hover {
            background: linear-gradient(120deg, #FF5252, #FF7676);
            box-shadow: 0 8px 16px rgba(255,107,107,0.3);
        }
        .clear-btn {
            background: linear-gradient(120deg, #4ECDC4, #45B7AF);
            box-shadow: 0 6px 12px rgba(78,205,196,0.2);
        }
        .clear-btn:hover {
            background: linear-gradient(120deg, #3DBDB4, #3AA79F);
            box-shadow: 0 8px 16px rgba(78,205,196,0.3);
        }
        .random-btn {
            background: linear-gradient(120deg, #FFD93D, #FFA41B);
            box-shadow: 0 6px 12px rgba(255,217,61,0.2);
        }
        .random-btn:hover {
            background: linear-gradient(120deg, #FFD000, #FF9500);
            box-shadow: 0 8px 16px rgba(255,217,61,0.3);
        }
        .download-music {
            background: linear-gradient(120deg, #FF6B6B, #FF8E8E);
            box-shadow: 0 6px 12px rgba(255,107,107,0.2);
        }
        .download-music:hover {
            background: linear-gradient(120deg, #FF5252, #FF7676);
            box-shadow: 0 8px 16px rgba(255,107,107,0.3);
        }
        .download-lyrics {
            background: linear-gradient(120deg, #4ECDC4, #45B7AF);
            box-shadow: 0 6px 12px rgba(78,205,196,0.2);
        }
        .download-lyrics:hover {
            background: linear-gradient(120deg, #3DBDB4, #3AA79F);
            box-shadow: 0 8px 16px rgba(78,205,196,0.3);
        }
        .download-pure {
            background: linear-gradient(120deg, #FFD93D, #FFA41B);
            box-shadow: 0 6px 12px rgba(255,217,61,0.2);
        }
        .download-pure:hover {
            background: linear-gradient(120deg, #FFD000, #FF9500);
            box-shadow: 0 8px 16px rgba(255,217,61,0.3);
        }
        .chart-select {
            width: 100%;
            padding: 16px 24px;
            border: 2px solid #e0e0e0;
            border-radius: 16px;
            font-size: 16px;
            background-color: #ffffff;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%232c3e50' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 20px center;
            background-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            color: #2c3e50;
        }
        .chart-select:focus {
            background-color: #e0e0e0;
            outline: none;
            border-color: #FF6B6B;
            box-shadow: 0 0 0 4px rgba(255,107,107,0.1);
        }
        .chart-select option {
            background-color: #ffffff;
            color: #2c3e50;
        }

        .random-music-group {
            display: flex;
            flex-direction: row;
            gap: 0;
            width: auto;
            margin-top: 0;
            grid-column: auto;
            align-items: center;
        }
        .random-music-group .action-btn {
            padding: 16px 24px;
        }
        .random-music-group .action-btn span {
            font-size: 16px;
        }
        .random-music-group .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255,107,107,0.3);
        }
        .random-music-group .action-btn:hover span {
            transform: translateX(5px);
        }
        .random-music-group .action-btn:hover::before {
            transform: translateX(100%);
        }
        .random-music-group .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(120deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
            transition: 0.5s;
        }
        .share-text {
            text-align: center;
            margin: 20px 0;
            font-size: 18px;
            color: #555;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .share-text:hover {
            color: #FF6B6B;
        }
        .share-text span {
            margin-right: 5px;
        }
        /* 美化调整播放器和相关按钮区域的样式 */
        .result > audio {
            width: 100%;
            margin-top: 30px; /* 增加与上方内容的间距 */
            margin-bottom: 20px; /* 增加与下方内容的间距 */
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(0,0,0,0.1);
        }
        .lyrics-copy-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* 调整列布局，使其在小屏幕上也能适应 */
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 20px; /* 增加与下方歌词的间距 */
        }
        .lyrics-copy-buttons .download-btn {
            width: 100%; /* 确保按钮在网格项中撑满 */
        }
        .click-to-copy-hint {
            text-align: center;
            font-size: 14px;
            color: #555;
            margin-top: 15px;
            margin-bottom: 40px; /* 增加与歌词区域的间距 */
        }
        /* result 区域两列布局容器 - 移除歌词相关样式 */
        .result-content-flex {
            display: flex;
            gap: 40px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .result-content-flex .song-cover {
            width: 100%;
            max-width: 300px;
            height: 300px;
            margin: 0 auto;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            animation: rotate 20s linear infinite;
            animation-play-state: paused;
        }

        .result-content-flex .song-cover.playing {
            animation-play-state: running;
        }

        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .result-content-flex .song-info {
            flex: 1;
            min-width: 300px;
            margin-bottom: 0;
            padding: 0;
            background: none;
            box-shadow: none;
            border: none;
            transform: none;
            transition: none;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
        }
        .result-content-flex .song-details {
            flex: 1;
            text-align: center;
        }
        .result-content-flex .song-details h2 {
            font-size: 28px;
            margin: 0;
            text-align: center;
        }
        .result-content-flex .song-details h2::after {
            left: 0;
            transform: none;
        }
        .result-content-flex .lyrics {
            flex: 1;
            min-width: 300px;
            margin: 0;
            max-height: 400px;
        }
        .action-buttons-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-top: 20px;
        }
        .download-buttons, .lyrics-copy-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .download-btn {
            min-width: 200px;
        }
        @media screen and (max-width: 768px) {
            .result-content-flex {
                flex-direction: column;
                gap: 20px;
            }
            .result-content-flex .song-info,
            .result-content-flex .lyrics {
                min-width: auto;
            }
            .download-buttons, .lyrics-copy-buttons {
                flex-direction: column;
                align-items: center;
            }
            .download-btn {
                width: 100%;
                max-width: 300px;
            }
        }
        /* 播放器容器样式 */
        .player-container {
            position: relative;
            margin: 30px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .plyr {
            --plyr-color-main: #FF6B6B;
            --plyr-audio-controls-background: transparent;
            --plyr-audio-control-color: #2c3e50;
            --plyr-audio-progress-buffered-background: rgba(255,255,255,0.1);
            --plyr-audio-range-track-background: rgba(0, 0, 0, 0.2);
            --plyr-tooltip-background: rgba(255,255,255,0.9);
            --plyr-tooltip-color: #2c3e50;
            border-radius: 0;
            overflow: visible;
            backdrop-filter: none;
            border: none;
        }

        .plyr--audio .plyr__controls {
            padding: 20px;
            background: transparent;
            display: flex;
            align-items: center;
            z-index: 10;
        }

        .plyr--audio .plyr__control {
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
        }

        .plyr--audio .plyr__control:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .plyr--audio .plyr__control--overlaid {
            background: linear-gradient(120deg, #FF6B6B, #FF8E8E);
            box-shadow: 0 4px 12px rgba(255,107,107,0.3);
        }

        .plyr--audio .plyr__control--overlaid:hover {
            background: linear-gradient(120deg, #FF5252, #FF7676);
            transform: scale(1.1);
        }

        .plyr--audio .plyr__progress__container {
            height: 8px;
            margin: 0 10px;
        }

        .plyr--audio .plyr__progress__buffer {
            background: rgba(255,255,255,0.1);
        }

        .plyr--audio .plyr__time {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }

        .plyr--audio .plyr__tooltip {
            background: rgba(255,255,255,0.9);
            color: #2c3e50;
            font-weight: 600;
            border-radius: 8px;
            padding: 8px 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        /* 隐藏音量控制和设置按钮 */
        .plyr--audio .plyr__volume,
        .plyr--audio .plyr__controls button[data-plyr="settings"],
        .plyr--audio .plyr__controls button[data-plyr="mute"] {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://p1.music.126.net/tBTNafgjNnTL1KlZMt7lVA==/18885211718935735.jpg" alt="网易云音乐" class="logo animate__animated animate__fadeIn" style="animation-delay: 0.2s">
            <h1 class="animate__animated animate__fadeInDown" style="animation-delay: 0.4s">网易云音乐解析</h1>
        </div>
        <div class="input-group animate__animated animate__fadeInUp" style="animation-delay: 0.6s">
            <input type="text" id="musicUrl" placeholder="请输入网易云音乐链接（支持分享链接和直接链接）" class="animate__animated animate__fadeInUp" style="animation-delay: 0.8s">
            <div class="action-buttons">
                <button class="action-btn search-btn animate__animated animate__fadeInUp" style="animation-delay: 1.0s" onclick="searchMusic()">
                    <span>🔍</span> 查询音乐
                </button>
                <button class="action-btn clear-btn animate__animated animate__fadeInUp" style="animation-delay: 1.2s" onclick="clearInput()">
                    <span>🗑️</span> 清空输入
                </button>
                <button class="action-btn random-btn animate__animated animate__fadeInUp" style="animation-delay: 1.4s" onclick="randomMusic()">
                    <span>🎲</span> 随机音乐
                </button>
            </div>
            <select id="musicChart" class="chart-select animate__animated animate__fadeInUp" style="animation-delay: 1.6s">
                <option value="热歌榜">热歌榜</option>
                <option value="新歌榜">新歌榜</option>
                <option value="飙升榜">飙升榜</option>
                <option value="原创榜">原创榜</option>
                <option value="全部随机">全部随机</option>
            </select>
        </div>

        <div class="welcome-text">
            <p class="animate__animated animate__fadeInUp" style="animation-delay: 1.8s">欢迎使用网易云音乐解析工具</p>
            <p class="animate__animated animate__fadeInUp" style="animation-delay: 2.0s">支持解析网易云音乐分享链接，获取<span class="highlight">高品质音乐</span>和<span class="highlight">歌词</span></p>
            <p class="animate__animated animate__fadeInUp" style="animation-delay: 2.2s">支持多种音质选择，包括<span class="highlight">无损音质</span>和<span class="highlight">Hi-Res</span></p>
            <p class="animate__animated animate__fadeInUp" style="animation-delay: 2.4s">支持复制歌词，带时间戳，方便导入其他软件</p>
            <p class="animate__animated animate__fadeInUp" style="animation-delay: 2.6s">支持随机播放，随机播放的音质为<span class="highlight">超清母带</span></p>
            <p class="animate__animated animate__fadeInUp" style="animation-delay: 2.8s" class="highlight">注意：请勿用于商业用途，请勿用于非法用途</p>
            <p class="animate__animated animate__fadeInUp" style="animation-delay: 3.0s">如果你喜欢可以点击分享网页分享给好友</p>
            <p class="share-text animate__animated animate__fadeInUp" style="animation-delay: 3.2s" onclick="sharePage()"><span>📤</span> 分享网页</p>
        </div>
        <div class="result" id="result">
            <div class="result-content-flex animate__animated animate__fadeIn">
                <div class="song-info animate__animated animate__fadeInLeft" style="animation-delay: 0.2s">
                    <img id="songCover" class="song-cover animate__animated animate__fadeIn" style="animation-delay: 0.4s" src="" alt="封面">
                    <div class="song-details animate__animated animate__fadeInUp" style="animation-delay: 0.6s">
                        <h2 id="songName"></h2>
                    </div>
                </div>
                <div class="lyrics animate__animated animate__fadeInRight" style="animation-delay: 0.8s" id="lyrics"></div>
            </div>
            <div class="player-container animate__animated animate__fadeInUp" style="animation-delay: 1.0s">
                <audio id="audioPlayer" controls></audio>
            </div>
            <div class="action-buttons-container animate__animated animate__fadeInUp" style="animation-delay: 1.2s">
                <div class="download-buttons">
                    <button class="download-btn download-music animate__animated animate__fadeInUp" style="animation-delay: 1.4s" onclick="downloadMusic()">
                        <span>⬇️</span> 下载音乐
                    </button>
                    <button class="download-btn download-lyrics animate__animated animate__fadeInUp" style="animation-delay: 1.6s" onclick="downloadLyricsWithTime()">
                        <span>📝</span> 下载歌词(带时间)
                    </button>
                    <button class="download-btn download-pure animate__animated animate__fadeInUp" style="animation-delay: 1.8s" onclick="downloadLyricsPureText()">
                        <span>📄</span> 下载歌词(纯文本)
                    </button>
                </div>
                <div class="lyrics-copy-buttons">
                    <button class="download-btn download-lyrics animate__animated animate__fadeInUp" style="animation-delay: 2.0s" onclick="copyAllLyricsWithTime()">
                        <span>📝</span> 复制歌词(带时间)
                    </button>
                    <button class="download-btn download-pure animate__animated animate__fadeInUp" style="animation-delay: 2.2s" onclick="copyAllLyricsPureText()">
                        <span>📄</span> 复制歌词(纯文本)
                    </button>
                </div>
            </div>
            <p class="click-to-copy-hint animate__animated animate__fadeInUp" style="animation-delay: 2.4s">单击即可复制单条歌词</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/plyr/3.7.8/plyr.min.js"></script>
    <script>
        // 配置对象
        const CONFIG = {
            API: {
                MUSIC: 'https://api.kxzjoker.cn/api/163_music',
                CHARTS: {

                    '热歌榜': 'https://api.vvhan.com/api/wyMusic/热歌榜?type=json',
                    '新歌榜': 'https://api.vvhan.com/api/wyMusic/新歌榜?type=json',
                    '飙升榜': 'https://api.vvhan.com/api/wyMusic/飙升榜?type=json',
                    '原创榜': 'https://api.vvhan.com/api/wyMusic/原创榜?type=json',
                }
            },
            SHARE: {
                TITLE: '网易云音乐解析',
                TEXT: '一个简单好用的网易云音乐解析工具，支持多种音质下载和歌词获取！',
                URL: 'https://music.sihoyo.cn'
            }
        };

        // UI 控制类
        class UIController {
            constructor() {
                this.elements = {
                    musicUrl: document.getElementById('musicUrl'),
                    result: document.getElementById('result'),
                    welcomeText: document.querySelector('.welcome-text'),
                    songName: document.getElementById('songName'),
                    artistName: document.getElementById('artistName'),
                    albumName: document.getElementById('albumName'),
                    qualityInfo: document.getElementById('qualityInfo'),
                    fileSize: document.getElementById('fileSize'),
                    songCover: document.getElementById('songCover'),
                    lyrics: document.getElementById('lyrics')
                };
                this.colorInterval = null;
            }

            showResult() {
                this.elements.result.style.display = 'block';
                this.elements.welcomeText.style.display = 'none';
                this.startColorChange();
            }

            showWelcome() {
                this.elements.welcomeText.style.display = 'block';
                this.elements.result.style.display = 'none';
                this.stopColorChange();
            }

            updateSongInfo(data) {
                this.elements.songName.textContent = data.name;
                this.elements.songCover.src = data.pic;
            }

            clearInput() {
                this.elements.musicUrl.value = '';
                this.elements.result.style.display = 'none';
                this.showWelcome();
            }

            startColorChange() {
                if (this.colorInterval) {
                    clearInterval(this.colorInterval);
                }
                this.colorInterval = setInterval(() => {
                    const randomColor = this.getRandomColor();
                    this.elements.songName.style.color = randomColor;
                }, 2000); // 每2秒改变一次颜色
            }

            stopColorChange() {
                if (this.colorInterval) {
                    clearInterval(this.colorInterval);
                    this.colorInterval = null;
                }
                this.elements.songName.style.color = '#2c3e50'; // 恢复默认颜色
            }

            getRandomColor() {
                const colors = [
                    '#FF6B6B', // 红色
                    '#4ECDC4', // 青色
                    '#FFD93D', // 黄色
                    '#6B8DD6', // 蓝色
                    '#FF8E8E', // 粉色
                    '#45B7AF', // 深青色
                    '#FFA41B', // 橙色
                    '#3DBDB4'  // 浅青色
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }
        }

        // 音乐播放器类
        class MusicPlayer {
            constructor() {
                this.player = new Plyr('#audioPlayer', {
                    controls: [
                        'play-large',
                        'play',
                        'progress',
                        'current-time',
                        'duration',
                        'fullscreen'
                    ]
                });
                this.currentMusicData = null;
                this.setupEventListeners();
            }

            setupEventListeners() {
                this.player.on('timeupdate', () => this.updateLyricsScroll());
                this.player.on('play', () => {
                    document.querySelector('.song-cover').classList.add('playing');
                });
                this.player.on('pause', () => {
                    document.querySelector('.song-cover').classList.remove('playing');
                });
            }

            updateSource(url) {
                this.player.source = {
                    type: 'audio',
                    sources: [{ src: url, type: 'audio/mp3' }]
                };
            }

            updateLyricsScroll() {
                if (!this.currentMusicData?.parsedLyrics) return;

                const currentTime = this.player.currentTime;
                const lyricsElement = document.getElementById('lyrics');
                const lyricsParagraphs = lyricsElement.querySelectorAll('p[data-time]');
                
                let activeLyricIndex = -1;
                for (let i = 0; i < this.currentMusicData.parsedLyrics.length; i++) {
                    if (currentTime >= this.currentMusicData.parsedLyrics[i].time && 
                        (i === this.currentMusicData.parsedLyrics.length - 1 || 
                         currentTime < this.currentMusicData.parsedLyrics[i + 1].time)) {
                        activeLyricIndex = i;
                        break;
                    }
                }

                lyricsParagraphs.forEach(p => {
                    p.classList.remove('active');
                    p.style.opacity = '0.6';
                    p.style.transform = 'translateY(0)';
                });

                if (activeLyricIndex !== -1) {
                    const activeParagraph = lyricsParagraphs[activeLyricIndex];
                    activeParagraph.classList.add('active');
                    activeParagraph.style.opacity = '1';
                    activeParagraph.style.transform = 'translateY(-2px)';
                    
                    // 平滑滚动到当前歌词
                    const containerHeight = lyricsElement.offsetHeight;
                    const scrollTop = activeParagraph.offsetTop - (containerHeight / 2) + (activeParagraph.offsetHeight / 2);
                    lyricsElement.scrollTo({
                        top: scrollTop,
                        behavior: 'smooth'
                    });
                }
            }
        }

        // 歌词处理类
        class LyricsHandler {
            static parseLyrics(lyrics) {
                const parsedLyrics = [];
                const lyricsHtml = [];
                
                lyrics.split('\n').forEach(line => {
                    const timeMatch = line.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)/);
                    if (timeMatch) {
                        const minutes = parseInt(timeMatch[1], 10);
                        const seconds = parseInt(timeMatch[2], 10);
                        const milliseconds = parseInt(timeMatch[3], 10);
                        const timeInSeconds = minutes * 60 + seconds + milliseconds / (timeMatch[3].length === 3 ? 1000 : 100);
                        const text = timeMatch[4].trim();
                        if (text) {
                            parsedLyrics.push({ time: timeInSeconds, text: text });
                            lyricsHtml.push(`<p data-time="${timeInSeconds}" onclick="copyLyricText('${text.replace(/'/g, "\\'")}')"><span class="time">${timeMatch[1]}:${timeMatch[2]}.${timeMatch[3]}</span>${text}</p>`);
                        }
                    } else if (line.trim()) {
                        lyricsHtml.push(`<p>${line.trim()}</p>`);
                    }
                });

                return { parsedLyrics, lyricsHtml: lyricsHtml.join('') };
            }
        }

        // 工具函数
        const Utils = {
            copyToClipboard(text, description = '内容') {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                
                textarea.select();
                try {
                    document.execCommand('copy');
                    alert(`${description}已复制到剪贴板！`);
                } catch (err) {
                    console.error('复制失败:', err);
                    alert(`复制失败，请手动复制以下${description}：\n\n` + text);
                }
                
                document.body.removeChild(textarea);
            },

            async fetchWithTimeout(url, options = {}, timeout = 10000) {
                const controller = new AbortController();
                const id = setTimeout(() => controller.abort(), timeout);
                try {
                    const response = await fetch(url, { ...options, signal: controller.signal });
                    clearTimeout(id);
                    return response;
                } catch (error) {
                    clearTimeout(id);
                    throw error;
                }
            }
        };

        // 初始化
        const ui = new UIController();
        const player = new MusicPlayer();

        // 事件处理函数
        async function searchMusic() {
            const musicUrl = ui.elements.musicUrl.value;
            
            if (!musicUrl) {
                alert('请输入音乐链接');
                return;
            }

            const urlMatch = musicUrl.match(/(?:https?:\/\/163cn\.tv\/\w+)|(?:https?:\/\/music\.163\.com\/song\?id=\d+(?:&.*)?)/);
            if (!urlMatch) {
                alert('请输入正确的网易云音乐链接（支持分享链接和直接链接）');
                return;
            }

            try {
                const response = await Utils.fetchWithTimeout(
                    `${CONFIG.API.MUSIC}?url=${encodeURIComponent(urlMatch[0])}&level=jymaster&type=json`
                );
                const data = await response.json();

                if (data.status === 200) {
                    player.currentMusicData = data;
                    ui.updateSongInfo(data);
                    
                    const { parsedLyrics, lyricsHtml } = LyricsHandler.parseLyrics(data.lyric);
                    player.currentMusicData.parsedLyrics = parsedLyrics;
                    ui.elements.lyrics.innerHTML = lyricsHtml;
                    
                    player.updateSource(data.url);
                    ui.showResult();
                    showResultWithAnimation();
                } else {
                    alert('获取音乐信息失败');
                    ui.showWelcome();
                }
            } catch (error) {
                alert('请求失败，请稍后重试');
                console.error(error);
                ui.showWelcome();
            }
        }

        async function randomMusic() {
            const chartSelect = document.getElementById('musicChart');
            const selectedChart = chartSelect.value;
            const apiUrl = CONFIG.API.CHARTS[selectedChart];

            if (!apiUrl) {
                alert('无效的榜单选择');
                return;
            }

            try {
                const response = await Utils.fetchWithTimeout(apiUrl);
                const data = await response.json();

                if (data.success && data.info?.id) {
                    const musicUrl = `https://music.163.com/song?id=${data.info.id}`;
                    ui.elements.musicUrl.value = musicUrl;
                    await searchMusic();
                } else {
                    alert('获取随机音乐失败');
                    ui.showWelcome();
                }
            } catch (error) {
                alert('请求随机音乐API失败');
                console.error(error);
                ui.showWelcome();
            }
        }

        function sharePage() {
            if (navigator.share) {
                navigator.share(CONFIG.SHARE).catch(error => {
                    console.error('分享失败:', error);
                });
            }
            Utils.copyToClipboard(CONFIG.SHARE.URL, '分享链接');
        }

        // 添加动画效果
        function addAnimation(element, animation) {
            element.classList.add('animate__animated', animation);
        }

        // 在搜索结果加载时添加动画
        function showResultWithAnimation() {
            const result = document.getElementById('result');
            const songInfo = result.querySelector('.song-info');
            const lyrics = result.querySelector('.lyrics');
            const player = result.querySelector('.player-container');

            addAnimation(songInfo, 'animate__fadeInLeft');
            addAnimation(lyrics, 'animate__fadeInRight');
            addAnimation(player, 'animate__fadeInUp');
        }

        // 导出全局函数
        window.searchMusic = searchMusic;
        window.randomMusic = randomMusic;
        window.sharePage = sharePage;
        window.clearInput = () => ui.clearInput();
        window.copyLyricText = (text) => Utils.copyToClipboard(text, '歌词');
        window.copyAllLyricsWithTime = () => {
            if (!player.currentMusicData?.lyric) {
                alert('请先搜索音乐');
                return;
            }
            Utils.copyToClipboard(player.currentMusicData.lyric, '完整歌词(带时间)');
        };
        window.copyAllLyricsPureText = () => {
            if (!player.currentMusicData?.lyric) {
                alert('请先搜索音乐');
                return;
            }
            const lyrics = player.currentMusicData.lyric.split('\n')
                .map(line => line.replace(/\[.*?\]/g, '').trim())
                .filter(line => line)
                .join('\n');
            Utils.copyToClipboard(lyrics, '完整歌词(纯文本)');
        };
        window.downloadMusic = async () => {
            if (!player.currentMusicData?.url) {
                alert('请先搜索音乐');
                return;
            }

            try {
                const response = await fetch(player.currentMusicData.url);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `${player.currentMusicData.name || 'music'}.mp3`;
                document.body.appendChild(link);
                link.click();
                
                // 恢复原始下载逻辑（或者其他下载方式，取决于用户需求）
                window.location.href = player.currentMusicData.url;

                document.body.removeChild(link);
                URL.revokeObjectURL(url); // 释放 Blob URL 资源
            } catch (error) {
                console.error('下载音乐失败:', error);
                alert('下载音乐失败，请稍后重试。');
            }
        };
        window.downloadLyricsWithTime = () => {
            if (!player.currentMusicData?.lyric) {
                alert('请先搜索音乐');
                return;
            }
            const blob = new Blob([player.currentMusicData.lyric], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${player.currentMusicData.name} - 歌词(带时间).txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };
        window.downloadLyricsPureText = () => {
            if (!player.currentMusicData?.lyric) {
                alert('请先搜索音乐');
                return;
            }
            const lyrics = player.currentMusicData.lyric.split('\n')
                .map(line => line.replace(/\[.*?\]/g, '').trim())
                .filter(line => line)
                .join('\n');
            const blob = new Blob([lyrics], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${player.currentMusicData.name} - 歌词(纯文本).txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        };
    </script>
</body>
</html>
